<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#EAF6FF" />
  <link rel="manifest" href="manifest.json" />
  <title>Koala OrmanÄ±</title>
  <style>
    body { margin:0; font-family: -apple-system, system-ui, Arial; background:#EAF6FF; color:#0f172a; }
    .wrap { max-width: 520px; margin: 0 auto; padding: 16px; }
    .card { background:#fff; border-radius:16px; padding:16px; box-shadow: 0 6px 20px rgba(0,0,0,.06); }
    h1 { font-size: 22px; margin: 0 0 10px; }
    .sub { opacity:.75; margin: 0 0 14px; font-weight:700; }
    .ver { display:inline-block; font-size:12px; font-weight:900; padding:6px 10px; border-radius:999px; background:#EAF2FF; color:#1F6FEB; }

    .btn { width:100%; border:0; border-radius:14px; padding:14px; margin:10px 0; font-size:16px; font-weight:900; background:#1F6FEB; color:#fff; }
    .btn.secondary { background:#EAF2FF; color:#1F6FEB; }
    .btn.ghost { background:#F1F5F9; color:#0f172a; }

    .row { display:flex; gap:10px; flex-wrap:wrap; margin-top:14px; }
    .pill { background:#F1F5F9; padding:10px 12px; border-radius:999px; font-weight:900; }
    .toast { margin-top: 10px; font-weight: 900; min-height: 24px; }
    .hidden { display:none; }

    /* GAME */
    .topbar { display:flex; justify-content:space-between; align-items:center; gap:10px; }
    .topbar .left { display:flex; gap:10px; flex-wrap:wrap; }
    .qcard { background:#fff; border-radius:16px; padding:16px; box-shadow: 0 6px 20px rgba(0,0,0,.06); margin-top:12px; }
    .q { font-size: 38px; font-weight: 900; text-align:center; margin: 6px 0 8px; }
    .hint { text-align:center; opacity:.75; margin:0 0 10px; font-weight:800; }
    .ans { font-size: 28px; font-weight: 900; text-align:center; background:#F8FAFC; border-radius:14px; padding:12px; min-height: 38px; }

    .keypad { display:flex; flex-wrap:wrap; gap:10px; margin-top:12px; }
    .key { width: calc(33.333% - 6.666px); border:0; border-radius:14px; padding:14px 0; font-size:18px; font-weight:900; background:#fff; }
    .key.alt { background:#EAF2FF; color:#1F6FEB; }

    /* Koala kartlarÄ± */
    .koalaStrip { display:flex; gap:10px; flex-wrap:wrap; margin-top: 10px; }
    .koala {
      width: 52px; height: 52px;
      border-radius: 16px;
      position: relative;
      display:flex; align-items:center; justify-content:center;
      box-shadow: 0 6px 16px rgba(0,0,0,.08);
      overflow:hidden;
      user-select:none;
    }
    .koala::before {
      content:"";
      position:absolute;
      width: 18px; height: 18px; border-radius: 10px;
      left: 6px; top: 6px;
      background: rgba(255,255,255,.35);
      box-shadow: 22px 0 0 rgba(255,255,255,.35);
    }
    .koFace {
      width: 26px; height: 26px; border-radius: 12px;
      background: rgba(255,255,255,.35);
      display:flex; align-items:center; justify-content:center;
      font-size: 16px;
      font-weight: 900;
    }
    .acc { position:absolute; right: 6px; bottom: 6px; font-size: 14px; filter: drop-shadow(0 2px 2px rgba(0,0,0,.15)); }
    .lvl { position:absolute; left: 6px; bottom: 6px; font-size: 12px; opacity: .9; }

    /* Forest */
    .forestGrid { display:flex; flex-direction:column; gap:12px; margin-top:12px; }
    .tree {
      background: linear-gradient(180deg, rgba(123,228,149,.25), rgba(255,255,255,.95));
      border-radius: 18px;
      padding: 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,.06);
      border: 1px solid rgba(15,23,42,.06);
    }
    .treeHead { display:flex; justify-content:space-between; align-items:center; font-weight: 900; margin-bottom: 10px; }
    .slots { display:grid; grid-template-columns: repeat(4, 1fr); gap:10px; }
    .slot {
      height: 62px;
      border-radius: 16px;
      background: #F8FAFC;
      display:flex; align-items:center; justify-content:center;
      border: 1px dashed rgba(15,23,42,.14);
    }

    /* Overlay */
    .overlay {
      position:fixed; inset:0;
      background: rgba(15,23,42,.38);
      display:none;
      align-items:center; justify-content:center;
      padding: 18px;
      z-index: 9999;
    }
    .overlay.show { display:flex; }
    .modal {
      width: min(520px, 100%);
      background:#fff;
      border-radius:18px;
      padding:16px;
      box-shadow: 0 16px 60px rgba(0,0,0,.25);
      position:relative;
      overflow:hidden;
    }
    .modal h2 { margin:0 0 6px; font-size:18px; }
    .modal p { margin:0 0 12px; opacity:.82; font-weight:800; }
    .bigRow { display:flex; gap:12px; flex-wrap:wrap; margin-top: 10px; }

    .spark {
      position:absolute; inset:-40px;
      background:
        radial-gradient(circle at 15% 25%, rgba(255,212,122,.55) 0 7px, transparent 8px),
        radial-gradient(circle at 70% 30%, rgba(122,214,161,.55) 0 7px, transparent 8px),
        radial-gradient(circle at 40% 75%, rgba(200,185,255,.55) 0 7px, transparent 8px),
        radial-gradient(circle at 85% 70%, rgba(234,246,255,.95) 0 7px, transparent 8px);
      opacity:.95;
      animation: floaty 2.0s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes floaty { 0%{ transform: translateY(0);} 50%{ transform: translateY(10px);} 100%{ transform: translateY(0);} }

    .bounce { animation: bounce .75s ease-in-out 2; }
    @keyframes bounce { 0%{ transform: translateY(0);} 50%{ transform: translateY(-10px);} 100%{ transform: translateY(0);} }

    .pulse { animation: pulse .5s ease-in-out 2; }
    @keyframes pulse { 0%{ transform: scale(1);} 50%{ transform: scale(1.03);} 100%{ transform: scale(1);} }
  </style>
</head>
<body>
  <div class="wrap">

    <!-- HOME -->
    <div class="card" id="home">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
        <h1 style="margin:0;">Peri ve Ä°pekâ€™in Koala OrmanÄ±</h1>
        <span class="ver">v8</span>
      </div>

      <p class="sub">BugÃ¼n 5 dakika. ÃœzÃ¼lmek yok. Koalalar bÃ¼yÃ¼r.</p>

      <button class="btn" onclick="startMode('speed')">HÄ±z Turu</button>
      <button class="btn" onclick="startMode('target')">Hedef Turu</button>
      <button class="btn" onclick="startMode('boss')">Boss</button>

      <button class="btn secondary" onclick="showForest()">Ormana Bak ğŸŒ³</button>

      <div class="row">
        <div class="pill">â­ <span id="stars">0</span></div>
        <div class="pill">ğŸƒ <span id="leaves">0</span></div>
        <div class="pill">ğŸŒ³ <span id="trees">1</span></div>
        <div class="pill">âœ¨ XP: <span id="xp">0</span></div>
      </div>

      <div class="koalaStrip" id="homeKoalas"></div>
      <div class="toast" id="toast"></div>
    </div>

    <!-- GAME -->
    <div id="game" class="hidden">
      <div class="topbar">
        <div class="left">
          <div class="pill">â­ <span id="gStars">0</span></div>
          <div class="pill">ğŸƒ <span id="gLeaves">0</span></div>
          <div class="pill">âœ¨ <span id="gXp">0</span></div>
          <div class="pill"><span id="gIndex">1</span>/<span id="gTotal">10</span></div>
        </div>
        <button class="btn ghost" style="width:auto; margin:0; padding:10px 12px;" onclick="backHome()">Geri</button>
      </div>

      <div class="qcard" id="qcard">
        <p class="hint" id="modeText">HÄ±z Turu</p>
        <div class="q" id="question">2 Ã— 2 = ?</div>
        <div class="ans" id="answerBox">&nbsp;</div>

        <div class="keypad">
          <button class="key" onclick="tap('1')">1</button>
          <button class="key" onclick="tap('2')">2</button>
          <button class="key" onclick="tap('3')">3</button>
          <button class="key" onclick="tap('4')">4</button>
          <button class="key" onclick="tap('5')">5</button>
          <button class="key" onclick="tap('6')">6</button>
          <button class="key" onclick="tap('7')">7</button>
          <button class="key" onclick="tap('8')">8</button>
          <button class="key" onclick="tap('9')">9</button>

          <button class="key alt" onclick="clearAns()">Sil</button>
          <button class="key" onclick="tap('0')">0</button>
          <button class="key alt" onclick="ok()">OK</button>
        </div>

        <div class="toast" id="gToast"></div>
      </div>
    </div>

    <!-- FOREST -->
    <div class="card hidden" id="forest">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
        <h1 style="margin:0;">Orman</h1>
        <span class="ver">lvl</span>
      </div>

      <p class="sub">Koalalar bÃ¼yÃ¼r: ğŸŒ± yavru â†’ ğŸŒ¿ genÃ§ â†’ ğŸƒ usta â†’ âœ¨ bilge</p>

      <div class="row">
        <div class="pill">ğŸŒ³ <span id="fTrees">1</span></div>
        <div class="pill">ğŸ¨ <span id="fKoalas">1</span></div>
      </div>

      <div class="forestGrid" id="forestGrid"></div>

      <div class="toast" id="fToast"></div>
      <button class="btn ghost" onclick="backHome()">Geri</button>
    </div>

  </div>

  <!-- Overlay -->
  <div class="overlay" id="overlay">
    <div class="modal">
      <div class="spark"></div>
      <h2 id="ovTitle">ğŸ‰</h2>
      <p id="ovText">...</p>
      <div class="bigRow" id="ovRow"></div>
      <button class="btn" onclick="closeOverlay()">Tamam</button>
    </div>
  </div>

  <script>
    const SKEY="koala_state_v8";

    // --- varyasyon ---
    const PALETTES = ["#C8B9FF","#BFE8C6","#A7D8FF","#FFD6E7","#D3D8E6","#FFE7B0","#B7F0FF","#D9FFE1"];
    const ACCESSORIES = ["", "ğŸŒ¿", "ğŸŒ¸", "ğŸ§£", "â­", "ğŸ‘‘"];

    // nadir hayvanlar (Ã§ok nadir: %2)
    const RARE = [
      { name:"ZÃ¼mrÃ¼t Tilki", face:"ğŸ¦Š", bg:"#BFE8C6" },
      { name:"Ay BaykuÅŸu", face:"ğŸ¦‰", bg:"#A7D8FF" },
      { name:"Ay IÅŸÄ±ÄŸÄ± Panda", face:"ğŸ¼", bg:"#D3D8E6" }
    ];

    // mastery havuzu: 2..9
    const FACTS = [];
    for(let a=2;a<=9;a++){
      for(let b=2;b<=9;b++){
        FACTS.push({a,b, key: a+"x"+b});
      }
    }

    function rng(seed){ let x = Math.sin(seed) * 10000; return x - Math.floor(x); }

    function makeKoala(seed){
      const p = Math.floor(rng(seed) * PALETTES.length);
      const a = Math.floor(rng(seed*7.1) * ACCESSORIES.length);
      const e = 1 + Math.floor(rng(seed*11.7) * 3);
      return { kind:"koala", id:String(seed)+"_"+Math.floor(rng(seed*3.3)*100000), palette:p, accessory:a, eyes:e, lvl:1 };
    }
    function makeRare(seed){
      const r = RARE[Math.floor(rng(seed*9.3) * RARE.length)];
      return { kind:"rare", id:"r_"+String(seed)+"_"+Math.floor(rng(seed*5.5)*100000), name:r.name, face:r.face, bg:r.bg, lvl:1 };
    }

    function eyesChar(e){ return e===1 ? "â€¢á´¥â€¢" : e===2 ? "Ë˜á´¥Ë˜" : "â€¢â©Šâ€¢"; }
    function lvlEmoji(l){ return l===1 ? "ğŸŒ±" : l===2 ? "ğŸŒ¿" : l===3 ? "ğŸƒ" : "âœ¨"; }

    function koalaCard(k, big=false){
      const size = big ? 62 : 52;
      const el = document.createElement("div");
      el.className = "koala";
      el.style.width = size+"px";
      el.style.height = size+"px";

      const face = document.createElement("div");
      face.className = "koFace";
      face.style.fontSize = big ? "18px" : "16px";

      const accEl = document.createElement("div");
      accEl.className = "acc";

      if(k.kind === "rare"){
        el.style.background = k.bg || "#EAF2FF";
        face.textContent = k.face;
        accEl.textContent = "âœ¨";
      } else {
        el.style.background = PALETTES[k.palette] || PALETTES[0];
        face.textContent = eyesChar(k.eyes);
        accEl.textContent = ACCESSORIES[k.accessory] || "";
      }

      const lvlEl = document.createElement("div");
      lvlEl.className = "lvl";
      lvlEl.textContent = lvlEmoji(k.lvl);

      el.appendChild(face);
      if(accEl.textContent) el.appendChild(accEl);
      el.appendChild(lvlEl);
      return el;
    }

    // --- state ---
    function loadState(){
      try{
        const raw = localStorage.getItem(SKEY);
        if(raw) return JSON.parse(raw);
      } catch {}
      // mastery baÅŸlangÄ±Ã§
      const mastery = {};
      FACTS.forEach(f => mastery[f.key] = { seen:0, correct:0, wrong:0, bestMs:null, streak:0 });
      return { stars:0, leaves:0, xp:0, koalas:[makeKoala(Date.now())], mastery };
    }

    const state = loadState();
    if(!Array.isArray(state.koalas) || state.koalas.length===0) state.koalas = [makeKoala(Date.now())];
    if(typeof state.xp !== "number") state.xp = 0;
    if(!state.mastery){
      state.mastery = {};
      FACTS.forEach(f => state.mastery[f.key] = { seen:0, correct:0, wrong:0, bestMs:null, streak:0 });
    } else {
      // eksik keyleri tamamla
      FACTS.forEach(f => { if(!state.mastery[f.key]) state.mastery[f.key] = { seen:0, correct:0, wrong:0, bestMs:null, streak:0 }; });
    }

    function treesNow(){ return Math.max(1, Math.ceil(state.koalas.length/4)); }

    function save(){
      state.trees = treesNow();
      try { localStorage.setItem(SKEY, JSON.stringify(state)); } catch {}
    }

    function $(id){ return document.getElementById(id); }

    function show(id){
      $("home").classList.add("hidden");
      $("game").classList.add("hidden");
      $("forest").classList.add("hidden");
      $(id).classList.remove("hidden");
    }

    function renderHome(){
      $("stars").textContent = state.stars;
      $("leaves").textContent = state.leaves;
      $("trees").textContent = treesNow();
      $("xp").textContent = state.xp;

      const strip = $("homeKoalas");
      strip.innerHTML = "";
      for(let i=0;i<Math.min(8, state.koalas.length); i++){
        strip.appendChild(koalaCard(state.koalas[i]));
      }
    }

    function renderForest(){
      const trees = treesNow();
      $("fTrees").textContent = trees;
      $("fKoalas").textContent = state.koalas.length;

      const grid = $("forestGrid");
      grid.innerHTML = "";

      for(let t=0; t<trees; t++){
        const tree = document.createElement("div");
        tree.className = "tree";

        const head = document.createElement("div");
        head.className = "treeHead";
        head.innerHTML = `<span>AÄŸaÃ§ ${t+1}</span><span>${(t*4+1)}â€“${Math.min((t+1)*4, state.koalas.length)}</span>`;
        tree.appendChild(head);

        const slots = document.createElement("div");
        slots.className = "slots";

        for(let s=0; s<4; s++){
          const idx = t*4 + s;
          const slot = document.createElement("div");
          slot.className = "slot";
          if(state.koalas[idx]) slot.appendChild(koalaCard(state.koalas[idx], true));
          slots.appendChild(slot);
        }
        tree.appendChild(slots);
        grid.appendChild(tree);
      }
    }

    // --- overlay ---
    function openOverlay(titleText, bodyText){
      $("ovTitle").textContent = titleText;
      $("ovText").textContent = bodyText;
      const row = $("ovRow");
      row.innerHTML = "";

      const start = Math.max(0, state.koalas.length-4);
      for(let i=start; i<state.koalas.length; i++){
        const el = koalaCard(state.koalas[i], true);
        el.classList.add("bounce");
        row.appendChild(el);
      }

      $("overlay").classList.add("show");
    }

    window.closeOverlay = function(){
      $("overlay").classList.remove("show");
    };

    // --- mastery seÃ§im ---
    function weightForFact(f){
      const m = state.mastery[f.key];
      const seen = m.seen || 0;
      const wrong = m.wrong || 0;
      const correct = m.correct || 0;
      const acc = (seen>0) ? (correct/seen) : 0;

      // yanlÄ±ÅŸlar aÄŸÄ±rlÄ±ÄŸÄ± arttÄ±rÄ±r, az gÃ¶rÃ¼lmÃ¼ÅŸse arttÄ±rÄ±r
      // doÄŸru oranÄ± yÃ¼kseldikÃ§e aÄŸÄ±rlÄ±k azalÄ±r
      let w = 1;
      w += wrong * 1.4;
      w += (seen < 4) ? 2.0 : (seen < 10) ? 1.0 : 0;
      w += (acc < 0.6) ? 1.2 : (acc < 0.8) ? 0.6 : 0;

      // Ã¼st Ã¼ste doÄŸru (streak) biraz azaltÄ±r
      w -= Math.min(1.2, (m.streak||0) * 0.25);

      // minimum
      if(w < 0.2) w = 0.2;
      return w;
    }

    function pickFact(){
      // roulette wheel
      let total = 0;
      const weights = FACTS.map(f => {
        const w = weightForFact(f);
        total += w;
        return w;
      });
      let r = Math.random() * total;
      for(let i=0;i<FACTS.length;i++){
        r -= weights[i];
        if(r <= 0) return FACTS[i];
      }
      return FACTS[FACTS.length-1];
    }

    // --- game ---
    const game = { mode:"speed", total:10, index:0, a:2, b:2, startMs:0, typed:"", key:"2x2" };

    function cfg(mode){
      if(mode==="speed") return { total: 12, label: "HÄ±z Turu" };
      if(mode==="target") return { total: 10, label: "Hedef Turu" };
      return { total: 20, label: "Boss" };
    }
    function leavesFor(ms){ return ms < 2500 ? 2 : ms < 4000 ? 1 : 0; }

    function nextQ(){
      game.typed = "";
      $("answerBox").innerHTML = "&nbsp;";
      $("gToast").textContent = "";

      const f = pickFact();
      game.a = f.a;
      game.b = f.b;
      game.key = f.key;

      $("question").textContent = `${game.a} Ã— ${game.b} = ?`;
      game.startMs = Date.now();

      $("gStars").textContent = state.stars;
      $("gLeaves").textContent = state.leaves;
      $("gXp").textContent = state.xp;
      $("gIndex").textContent = game.index + 1;
      $("gTotal").textContent = game.total;

      // seen++
      const m = state.mastery[game.key];
      m.seen = (m.seen||0) + 1;
      save();
    }

    // XP ve bÃ¼yÃ¼me
    const XP_PER_LEVEL = 20;   // her 20 XPâ€™de seviye
    const MAX_LVL = 4;

    function levelUpOne(){
      // en dÃ¼ÅŸÃ¼k level koalayÄ± yÃ¼kselt
      let idx = -1;
      let bestLvl = 999;
      for(let i=0;i<state.koalas.length;i++){
        const k = state.koalas[i];
        if((k.lvl||1) < bestLvl){
          bestLvl = (k.lvl||1);
          idx = i;
        }
      }
      if(idx >= 0){
        const k = state.koalas[idx];
        if((k.lvl||1) < MAX_LVL){
          k.lvl = (k.lvl||1) + 1;
          return k;
        }
      }
      return null;
    }

    function addXP(amount){
      let msg = null;
      state.xp += amount;

      // birden fazla level atlama ihtimaline karÅŸÄ± dÃ¶ngÃ¼
      while(state.xp >= XP_PER_LEVEL){
        state.xp -= XP_PER_LEVEL;
        const leveled = levelUpOne();
        if(leveled){
          msg = "Seviye atladÄ±! " + lvlEmoji(leveled.lvl);
        }
      }
      return msg;
    }

    // doÄŸumlar
    function ensureBirths(){
      const should = 1 + Math.floor(state.stars / 15);
      let born = null;
      let any = 0;

      while(state.koalas.length < should){
        const seed = Date.now() + state.koalas.length*999 + Math.floor(Math.random()*9999);
        const rare = Math.random() < 0.02; // %2
        const baby = rare ? makeRare(seed) : makeKoala(seed);
        state.koalas.push(baby);
        born = baby;
        any++;
      }

      const oldTrees = state.trees || 1;
      const newTrees = treesNow();
      state.trees = newTrees;

      return { any, born, tree: newTrees > oldTrees };
    }

    // --- global fonksiyonlar ---
    window.startMode = function(mode){
      const c = cfg(mode);
      game.mode = mode;
      game.total = c.total;
      game.index = 0;
      $("modeText").textContent = c.label;
      show("game");
      nextQ();
    };

    window.backHome = function(){
      show("home");
      renderHome();
      $("toast").textContent = "";
    };

    window.showForest = function(){
      show("forest");
      renderForest();
      $("fToast").textContent = "Orman burada ğŸŒ³";
    };

    window.tap = function(d){
      if(game.typed.length >= 3) return;
      game.typed += d;
      $("answerBox").textContent = game.typed;
    };

    window.clearAns = function(){
      game.typed = "";
      $("answerBox").innerHTML = "&nbsp;";
    };

    window.ok = function(){
      const ans = Number(game.typed);
      if(Number.isNaN(ans)){ $("gToast").textContent = "Bir sayÄ± yaz ğŸ™‚"; return; }

      const correct = game.a * game.b;
      const dt = Date.now() - game.startMs;

      const m = state.mastery[game.key];

      let baseMsg = "";
      let xpGain = 0;

      if(ans === correct){
        state.stars += 1;
        const l = leavesFor(dt);
        state.leaves += l;

        // mastery
        m.correct = (m.correct||0) + 1;
        m.streak = (m.streak||0) + 1;
        if(m.bestMs === null || dt < m.bestMs) m.bestMs = dt;

        // XP: doÄŸruya 2, hÄ±zlÄ±ysa +1/+2
        xpGain = 2 + (l===2 ? 2 : l===1 ? 1 : 0);

        baseMsg = l===2 ? "Ã‡ok hÄ±zlÄ±! ğŸƒğŸƒ" : l===1 ? "HÄ±zlÄ±! ğŸƒ" : "DoÄŸru! ğŸ¨";
      } else {
        // mastery
        m.wrong = (m.wrong||0) + 1;
        m.streak = 0;

        baseMsg = `Cevap: ${correct}`;
        xpGain = 0; // yanlÄ±ÅŸta XP yok (Ã¼zÃ¼cÃ¼ de yok, sadece bilgi)
      }

      // XP ve seviye
      let lvlMsg = null;
      if(xpGain > 0){
        lvlMsg = addXP(xpGain);
      }

      // doÄŸum / yeni aÄŸaÃ§
      const births = ensureBirths();

      save();
      $("gStars").textContent = state.stars;
      $("gLeaves").textContent = state.leaves;
      $("gXp").textContent = state.xp;

      const qc = $("qcard");
      qc.classList.remove("pulse"); void qc.offsetWidth; qc.classList.add("pulse");

      // overlay Ã¶ncelik sÄ±rasÄ±: yeni aÄŸaÃ§ > nadir > yeni koala > seviye atlama
      if(births.any > 0){
        if(births.tree){
          openOverlay("Yeni aÄŸaÃ§ aÃ§Ä±ldÄ±! ğŸŒ³âœ¨", "Orman geniÅŸledi. Koalalar topluca sevindi!");
        } else if(births.born && births.born.kind==="rare"){
          openOverlay("Nadir bir misafir geldi! âœ¨", births.born.name + " ormana uÄŸradÄ±.");
        } else {
          openOverlay("Yeni koala doÄŸdu! ğŸ‰", "HoÅŸ geldin kÃ¼Ã§Ã¼k koala!");
        }
      } else if(lvlMsg){
        openOverlay("Koala bÃ¼yÃ¼dÃ¼! âœ¨", lvlMsg);
      }

      // toast
      $("gToast").textContent = baseMsg + (xpGain>0 ? `  +${xpGain}XP` : "");

      game.index += 1;
      if(game.index >= game.total){
        setTimeout(() => { window.backHome(); $("toast").textContent = "Tur bitti ğŸŒ¿"; }, 300);
      } else {
        setTimeout(() => nextQ(), 300);
      }
    };

    // init
    state.trees = treesNow();
    save();
    renderHome();
    $("toast").textContent = "HazÄ±r âœ…";
  </script>
</body>
</html>
